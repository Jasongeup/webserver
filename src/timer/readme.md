# timer

定义了服务器的定时时间堆，实现处理非活动客户连接，包括TimerNode, HeapTimer类



## TimerNode类

### 功能

定时器，成员包括定时器序号、超时时间、超时回调函数、重载的<运算符



## HeapTimer类

### 功能

存储定时器的容器，用小根堆实现（没有直接使用priority_queue容器是因为其不支持更改指定元素，不支持删除指定元素），定时器事件到，则调用回调函数，支持更改定时时间、删除指定序号的定时器等，主要被WebServer类调用



### 参数

不接受参数，重要成员由存储定时器的vector, 定时器需要与堆中索引对应的哈希表，初始化时为vector申请一片内存



### 代码逻辑

- 在WebServer类中每次监听epoll表时，会检查时间堆，运行一次心搏函数，心搏函数循环检查堆顶元素，若当前时间已经大于定时时间，表示超时了，则调用结点的回调函数，并让元素出栈，直到堆顶元素定时时间没到
- 往堆中插入元素时，如果是新结点，则插入到堆尾，利用上滤操作调整堆；如果是已有的结点，则通过一次下滤或者一次下滤+一次上滤调整堆
- 删除堆中指定元素，则该元素与堆尾元素交换，再调整堆

